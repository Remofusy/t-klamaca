<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TÄ±klamaca</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  background:#0e0016;
  color:#fff;
  font-family:Arial;
}
.hidden{display:none}
.center{display:flex;justify-content:center;align-items:center;}
.card{background:rgba(0,0,0,.6);padding:40px;border-radius:16px;width:420px;text-align:center;}
.big{font-size:26px;padding:22px;}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none;cursor:pointer;}

/* LAYOUT */
#gameRoot{display:none;height:100vh;display:grid;grid-template-columns:260px 1fr 360px;}

/* SOL */
#leftMenu{background:#12001f;padding:10px;display:flex;flex-direction:column;gap:10px;}
.menuBtn{padding:12px;background:#7a3cff;color:#fff;font-weight:bold;cursor:pointer;border-radius:8px;border:none;}

/* SAÄ */
#sidePanel{padding:10px;display:flex;flex-direction:column;gap:10px;}
.panel{background:rgba(0,0,0,.5);padding:10px;border-radius:10px;}
#chatMessages{flex:1;overflow-y:auto;max-height:200px;}

/* POPUP */
.popup{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;justify-content:center;align-items:center;z-index:999;}
.popupBox{background:#1a002b;padding:20px;border-radius:14px;width:360px;text-align:center;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="center" id="auth">
  <div class="card">
    <h2>GiriÅŸ / KayÄ±t</h2>
    <input id="username" placeholder="KullanÄ±cÄ± AdÄ±">
    <input id="password" type="password" placeholder="Åifre">
    <button onclick="register()">KayÄ±t Ol</button>
    <button onclick="login()">GiriÅŸ Yap</button>
    <p id="authMsg"></p>
  </div>
</div>

<!-- OYUN ROOT -->
<div id="gameRoot">

  <!-- SOL -->
  <div id="leftMenu">
    <button class="menuBtn" onclick="openMarket()">ğŸ›’ Market</button>
    <button class="menuBtn" onclick="openCasino()">ğŸ° Casino</button>
    <button class="menuBtn" onclick="openCases()">ğŸ—ƒï¸ Kasalar</button>
  </div>

  <!-- ORTA -->
  <div class="center">
    <div class="card" id="game">
      <h2 id="score">AltÄ±n: 0</h2>
      <h3 id="power">TÄ±klama GÃ¼cÃ¼: 1</h3>
      <button class="big" onclick="clickScore()">ğŸ–±ï¸ TIKLA</button>
      <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>

  <!-- SAÄ -->
  <div id="sidePanel">
    <div class="panel">
      <h3>ğŸ† Ä°lk 5</h3>
      <ul id="board"></ul>
    </div>
    <div class="panel">
      <h3>ğŸ’¬ Chat</h3>
      <div id="chatMessages"></div>
      <input id="chatInput" placeholder="Mesaj yaz">
      <button onclick="sendMsg()">GÃ¶nder</button>
    </div>
  </div>

</div>

<!-- MARKET -->
<div id="market" class="popup">
  <div class="popupBox">
    <h2>ğŸ›’ Market</h2>
    <p id="powerInfo">TÄ±klama GÃ¼cÃ¼: Fiyat 100</p>
    <button onclick="buyPower()">TÄ±klama GÃ¼cÃ¼ ArtÄ±r</button>

    <p id="autoClickInfo">Oto Click: Fiyat 250 <span id="autoClickIcon">âš™ï¸</span></p>
    <button onclick="buyAutoClick()">Oto Click Al</button>

    <button onclick="closeMarket()">Kapat</button>
  </div>
</div>

<!-- CASINO -->
<div id="casino" class="popup">
  <div class="popupBox">
    <h2>ğŸª™ YazÄ± â€“ Tura</h2>
    <input id="bet" type="number" placeholder="Bahis miktarÄ±">
    <button onclick="playCoin('yazi')">YazÄ±</button>
    <button onclick="playCoin('tura')">Tura</button>
    <p id="coinInfo"></p>
    <button onclick="closeCasino()">Kapat</button>
  </div>
</div>

<!-- KASALAR -->
<div id="cases" class="popup">
  <div class="popupBox">
    <h2>ğŸ—ƒï¸ Kasalar</h2>
    <p>KasalarÄ± aÃ§ ve bonus kazan!</p>
    <button onclick="openCase()">Kasa AÃ§</button>
    <div id="inventory"></div>
    <button onclick="closeCases()">Kapat</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase,ref,set,push,onValue,runTransaction,get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// FIREBASE
const firebaseConfig={
  apiKey:"AIzaSyCGUe_LPKRAVz1IoqMDn-8ie9RWCrVRQLs",
  authDomain:"click-game-2de2f.firebaseapp.com",
  databaseURL:"https://click-game-2de2f-default-rtdb.firebaseio.com",
  projectId:"click-game-2de2f"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);

// DOM
const authDiv=document.getElementById("auth");
const gameRoot=document.getElementById("gameRoot");
const marketDiv=document.getElementById("market");
const casinoDiv=document.getElementById("casino");
const casesDiv=document.getElementById("cases");

let currentUser=null;
let usernameGlobal="";
let autoClickLevel=0;
let autoClickInterval = null;
let autoClickPrice=250;
let powerPrice=100;

// SHOW/HIDE
function showLogin(){ authDiv.style.display="flex"; gameRoot.style.display="none"; marketDiv.style.display="none"; casinoDiv.style.display="none"; casesDiv.style.display="none"; }
function showGame(){ authDiv.style.display="none"; gameRoot.style.display="grid"; }

// AUTH
window.register=async()=>{
  if(!username.value||!password.value) return;
  const snap=await get(ref(db,"usernames/"+username.value));
  if(snap.exists()){ authMsg.innerText="Bu kullanÄ±cÄ± adÄ± alÄ±nmÄ±ÅŸ"; return; }
  const r=await createUserWithEmailAndPassword(auth,username.value+"@c.local",password.value);
  await set(ref(db,"users/"+r.user.uid),{username:username.value,score:0,power:1,price:powerPrice,autoClick:0});
  await set(ref(db,"usernames/"+username.value),r.user.uid);
};
window.login=()=>signInWithEmailAndPassword(auth,username.value+"@c.local",password.value);
window.logout=()=>signOut(auth);

// SESSION
onAuthStateChanged(auth,user=>{
  if(user){
    currentUser=user;
    showGame();
    // AUTO CLICK
    onValue(ref(db,"users/"+user.uid),s=>{
      const d=s.val();
      score.innerText="AltÄ±n: "+Math.floor(d.score);
      power.innerText="TÄ±klama GÃ¼cÃ¼: "+d.power;
      powerPrice = d.price || 100;
      autoClickLevel = d.autoClick || 0;
      autoClickPrice = Math.floor(250 * Math.pow(1.15, autoClickLevel));
      updateMarketUI();
      usernameGlobal=d.username;
      // Auto click interval
      if(autoClickInterval) clearInterval(autoClickInterval);
      if(autoClickLevel>0){
        autoClickInterval = setInterval(()=>runTransaction(ref(db,"users/"+user.uid),d=>{
          d.score+=autoClickLevel;
          return d;
        }),1000);
      }
    });
  }else{
    currentUser=null;
    showLogin();
  }
});

// CLICK
window.clickScore=()=>runTransaction(ref(db,"users/"+currentUser.uid),d=>{
  d.score+=d.power;
  return d;
});

// MARKET
function updateMarketUI(){
  powerInfo.innerText=`TÄ±klama GÃ¼cÃ¼: Fiyat ${powerPrice}`;
  autoClickInfo.innerText=`Oto Click: Fiyat ${autoClickPrice}`;
  // Icon renk
  let icon="âš™ï¸";
  if(autoClickLevel>=1 && autoClickLevel<5) icon="âš™ï¸ğŸŸ¤";
  else if(autoClickLevel>=5 && autoClickLevel<25) icon="âš™ï¸âšª";
  else if(autoClickLevel>=25 && autoClickLevel<100) icon="âš™ï¸ğŸŸ¡";
  else if(autoClickLevel>=100 && autoClickLevel<250) icon="âš™ï¸ğŸ”µ";
  else if(autoClickLevel>=250 && autoClickLevel<500) icon="âš™ï¸âšª";
  document.getElementById("autoClickIcon").innerText = icon;
}
window.openMarket=()=>{ if(currentUser) marketDiv.style.display="flex"; }
window.closeMarket=()=>marketDiv.style.display="none";

window.buyPower=()=>runTransaction(ref(db,"users/"+currentUser.uid),d=>{
  if(d.score<powerPrice) return d;
  d.score-=powerPrice;
  d.power+=1;
  powerPrice = Math.floor(powerPrice*1.1);
  d.price=powerPrice;
  return d;
});
window.buyAutoClick=()=>runTransaction(ref(db,"users/"+currentUser.uid),d=>{
  if(d.score<autoClickPrice) return d;
  d.score-=autoClickPrice;
  autoClickLevel+=1;
  d.autoClick=autoClickLevel;
  autoClickPrice = Math.floor(autoClickPrice*1.15);
  return d;
});

// CASINO
window.openCasino=()=>{ if(currentUser) casinoDiv.style.display="flex"; }
window.closeCasino=()=>casinoDiv.style.display="none";
window.playCoin=(choice)=>{
  const amount=parseInt(bet.value);
  if(!amount||amount<=0) return;
  const result=Math.random()<0.5?"yazi":"tura";
  runTransaction(ref(db,"users/"+currentUser.uid),d=>{
    if(d.score<amount) return d;
    d.score-=amount;
    if(choice===result) d.score+=amount*2;
    coinInfo.innerText=`SonuÃ§: ${result.toUpperCase()} | ${choice===result?"KazandÄ±n":"Kaybettin"}`;
    return d;
  });
};

// KASALAR / ENVANTER
let inventory=[];
window.openCases=()=>{ if(currentUser) casesDiv.style.display="flex"; updateInventory(); }
window.closeCases=()=>casesDiv.style.display="none";

function openCase(){
  const reward = (Math.random()*4+1).toFixed(2); // 1x -5x
  inventory.push(reward);
  updateInventory();
}
function updateInventory(){
  inventoryDiv = document.getElementById("inventory");
  inventoryDiv.innerHTML = "Envanter: " + inventory.join(", ");
}

// SCOREBOARD + CHAT
onValue(ref(db,"users"),s=>{
  board.innerHTML="";
  Object.values(s.val()||{}).sort((a,b)=>b.score-a.score).slice(0,5).forEach(u=>{
    board.innerHTML+=`<li>${u.username}: ${Math.floor(u.score)}</li>`;
  });
});
onValue(ref(db,"chat"),s=>{
  chatMessages.innerHTML="";
  Object.values(s.val()||{}).forEach(m=>{
    chatMessages.innerHTML+=`${m.user}: ${m.text}<br>`;
  });
  chatMessages.scrollTop=chatMessages.scrollHeight;
});
window.sendMsg=()=>{
  const msg=chatInput.value.trim();
  if(!msg) return;
  if(msg==="/temizle"){ set(ref(db,"chat"),null); chatInput.value=""; return; }
  push(ref(db,"chat"),{user:usernameGlobal,text:msg});
  chatInput.value="";
};
</script>
</body>
</html>
