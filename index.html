<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Oyna Kral</title>
<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;background:#0e0016;color:#fff;font-family:Arial;}
.center{display:flex;justify-content:center;align-items:center;}
.card{background:rgba(0,0,0,.6);padding:40px;border-radius:16px;width:420px;text-align:center;}
.big{font-size:26px;padding:22px;}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none;cursor:pointer;}
#gameRoot{display:none;height:100vh;display:grid;grid-template-columns:260px 1fr 360px;}
#leftMenu{background:#12001f;padding:10px;display:flex;flex-direction:column;gap:10px;}
.menuBtn{padding:12px;background:#7a3cff;color:#fff;font-weight:bold;border-radius:8px;}
#sidePanel{padding:10px;display:flex;flex-direction:column;gap:10px;}
.panel{background:rgba(0,0,0,.5);padding:10px;border-radius:10px;}
#chatMessages{flex:1;overflow-y:auto;max-height:200px;}
.popup{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;justify-content:center;align-items:center;}
.popupBox{background:#1a002b;padding:20px;border-radius:14px;width:360px;text-align:center;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="center" id="auth">
  <div class="card">
    <h2>GiriÅŸ / KayÄ±t</h2>
    <input id="username" placeholder="KullanÄ±cÄ± AdÄ±">
    <input id="password" type="password" placeholder="Åifre">
    <button id="registerBtn">KayÄ±t Ol</button>
    <button id="loginBtn">GiriÅŸ Yap</button>
    <p id="authMsg"></p>
  </div>
</div>

<!-- GAME -->
<div id="gameRoot">
  <div id="leftMenu">
    <button class="menuBtn" id="marketBtn">ğŸ›’ Market</button>
    <button class="menuBtn" id="casinoBtn">ğŸ° Casino</button>
  </div>

  <div class="center">
    <div class="card">
      <h2 id="score">AltÄ±n: 0</h2>
      <h3 id="power">TÄ±klama GÃ¼cÃ¼: 1</h3>
      <button class="big" id="clickBtn">ğŸ–±ï¸ TIKLA</button>
      <button id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>

  <div id="sidePanel">
    <div class="panel">
      <h3>ğŸ† Ä°lk 5</h3>
      <ul id="board"></ul>
    </div>
    <div class="panel">
      <h3>ğŸ’¬ Chat</h3>
      <div id="chatMessages"></div>
      <input id="chatInput" placeholder="Mesaj yaz">
      <button id="sendBtn">GÃ¶nder</button>
    </div>
  </div>
</div>

<!-- MARKET -->
<div id="market" class="popup">
  <div class="popupBox">
    <h2>ğŸ›’ Market</h2>
    <p id="powerInfo"></p>
    <button id="buyPowerBtn">TÄ±klama GÃ¼cÃ¼ ArtÄ±r</button>
    <p id="autoClickInfo"></p>
    <button id="buyAutoClickBtn">Oto Click Al</button>
    <button id="closeMarketBtn">Kapat</button>
  </div>
</div>

<!-- CASINO -->
<div id="casino" class="popup">
  <div class="popupBox">
    <h2>ğŸª™ YazÄ± â€“ Tura</h2>
    <input id="bet" type="number" placeholder="Bahis">
    <button id="yaziBtn">YazÄ±</button>
    <button id="turaBtn">Tura</button>
    <p id="coinInfo"></p>
    <button id="closeCasinoBtn">Kapat</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase,ref,set,push,onValue,runTransaction,get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyCGUe_LPKRAVz1IoqMDn-8ie9RWCrVRQLs",
  authDomain:"click-game-2de2f.firebaseapp.com",
  databaseURL:"https://click-game-2de2f-default-rtdb.firebaseio.com",
  projectId:"click-game-2de2f"
};

const app=initializeApp(firebaseConfig);
const firebaseAuth=getAuth(app);
const db=getDatabase(app);

const authDiv=document.getElementById("auth");
const gameRoot=document.getElementById("gameRoot");

let currentUser=null;
let usernameGlobal="";
let powerPrice=100;
let autoClickLevel=0;
let autoClickPrice=250;
let autoClickInterval=null;

registerBtn.onclick=async()=>{
  if(!username.value||!password.value) return;
  const snap=await get(ref(db,"usernames/"+username.value));
  if(snap.exists()) return authMsg.innerText="KullanÄ±cÄ± adÄ± alÄ±nmÄ±ÅŸ";
  const r=await createUserWithEmailAndPassword(firebaseAuth,username.value+"@c.local",password.value);
  await set(ref(db,"users/"+r.user.uid),{username:username.value,score:0,power:1,price:100,autoClick:0});
  await set(ref(db,"usernames/"+username.value),r.user.uid);
};

loginBtn.onclick=()=>signInWithEmailAndPassword(firebaseAuth,username.value+"@c.local",password.value);
logoutBtn.onclick=()=>signOut(firebaseAuth);

onAuthStateChanged(firebaseAuth,user=>{
  if(!user){
    authDiv.style.display="flex";
    gameRoot.style.display="none";
    return;
  }
  currentUser=user;
  authDiv.style.display="none";
  gameRoot.style.display="grid";

  onValue(ref(db,"users/"+user.uid),s=>{
    const d=s.val(); if(!d) return;
    score.innerText="AltÄ±n: "+Math.floor(d.score);
    power.innerText="TÄ±klama GÃ¼cÃ¼: "+d.power;
    usernameGlobal=d.username;
    powerPrice=d.price;
    autoClickLevel=d.autoClick;
    autoClickPrice=Math.floor(250*Math.pow(1.15,autoClickLevel));
    powerInfo.innerText=`TÄ±klama GÃ¼cÃ¼ Fiyat: ${powerPrice}`;
    autoClickInfo.innerText=`Oto Click Fiyat: ${autoClickPrice}`;

    if(autoClickInterval) clearInterval(autoClickInterval);
    if(autoClickLevel>0){
      autoClickInterval=setInterval(()=>{
        runTransaction(ref(db,"users/"+user.uid),d=>{
          d.score+=autoClickLevel; return d;
        });
      },1000);
    }
  });
});

clickBtn.onclick=()=>runTransaction(ref(db,"users/"+currentUser.uid),d=>{
  d.score+=d.power; return d;
});

marketBtn.onclick=()=>market.style.display="flex";
closeMarketBtn.onclick=()=>market.style.display="none";
casinoBtn.onclick=()=>casino.style.display="flex";
closeCasinoBtn.onclick=()=>casino.style.display="none";

buyPowerBtn.onclick=()=>runTransaction(ref(db,"users/"+currentUser.uid),d=>{
  if(d.score<powerPrice) return d;
  d.score-=powerPrice; d.power++;
  d.price=Math.floor(powerPrice*1.1);
  return d;
});

buyAutoClickBtn.onclick=()=>runTransaction(ref(db,"users/"+currentUser.uid),d=>{
  if(d.score<autoClickPrice) return d;
  d.score-=autoClickPrice; d.autoClick++;
  return d;
});

yaziBtn.onclick=()=>coin("yazi");
turaBtn.onclick=()=>coin("tura");

function coin(c){
  const bet=parseInt(betInput.value||bet.value);
  runTransaction(ref(db,"users/"+currentUser.uid),d=>{
    if(d.score<bet) return d;
    d.score-=bet;
    const r=Math.random()<0.5?"yazi":"tura";
    if(r===c) d.score+=bet*2;
    coinInfo.innerText=`SonuÃ§: ${r}`;
    return d;
  });
}

onValue(ref(db,"users"),s=>{
  board.innerHTML="";
  Object.values(s.val()||{}).sort((a,b)=>b.score-a.score).slice(0,5)
  .forEach(u=>board.innerHTML+=`<li>${u.username}: ${Math.floor(u.score)}</li>`);
});

onValue(ref(db,"chat"),s=>{
  chatMessages.innerHTML="";
  Object.values(s.val()||{}).forEach(m=>{
    chatMessages.innerHTML+=`${m.user}: ${m.text}<br>`;
  });
  chatMessages.scrollTop=chatMessages.scrollHeight;
});

sendBtn.onclick=()=>{
  if(!chatInput.value) return;
  push(ref(db,"chat"),{user:usernameGlobal,text:chatInput.value});
  chatInput.value="";
};
</script>
</body>
</html>
