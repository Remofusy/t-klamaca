<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OynaKral</title>
    <style>
        /* PERFORMANS Ä°Ã‡Ä°N SADELEÅTÄ°RÄ°LMÄ°Å CSS */
        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; }
        
        body {
            height: 100vh;
            background: #111; /* DÃ¼z siyah/gri arka plan */
            color: #ddd;
            font-family: sans-serif; /* Standart font */
            overflow: hidden;
        }

        .hidden { display: none !important; }

        .center {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .card {
            background: #222; /* YarÄ± saydamlÄ±k kaldÄ±rÄ±ldÄ± */
            padding: 20px;
            border-radius: 4px; /* YuvarlaklÄ±k azaltÄ±ldÄ± */
            width: 400px;
            text-align: center;
            border: 2px solid #555; /* Parlayan kenarlÄ±k yerine dÃ¼z Ã§izgi */
            /* box-shadow kaldÄ±rÄ±ldÄ± */
        }

        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            border: 1px solid #444;
            font-size: 14px;
            background: #333;
            color: #fff;
            /* transition kaldÄ±rÄ±ldÄ± */
        }

        button {
            background: #4a2b96;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #666;
        }

        button:hover {
            background: #5c3bb3;
            /* transform (zÄ±plama) kaldÄ±rÄ±ldÄ± */
        }

        .admin-name { 
            color: #d559ff !important; 
            font-weight: bold; 
            /* text-shadow kaldÄ±rÄ±ldÄ± */
        }

        .user-name { 
            color: #9e6eff; 
            font-weight: bold; 
        }

        #gameRoot, #voleybolRoot, #rplaceRoot {
            height: 100vh;
            display: grid;
            grid-template-columns: 260px 1fr 320px;
        }

        .sidebar {
            background: #1a1a1a;
            padding: 15px;
            border-right: 1px solid #444;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
        }

        .chat-sidebar {
            background: #1a1a1a;
            padding: 10px;
            border-left: 1px solid #444;
            display: flex;
            flex-direction: column;
        }

        .chat-msgs {
            flex: 1;
            overflow-y: auto;
            background: #222;
            border-radius: 4px;
            padding: 10px;
            font-size: 13px;
            margin-bottom: 10px;
            border: 1px solid #444;
        }

        #rCenter { background: #333; overflow: auto; position: relative; }
        #canvasWrap { background: #fff; width: 2400px; height: 2400px; }
        #canvas { display: grid; grid-template-columns: repeat(200, 12px); width: 2400px; height: 2400px; }
        
        .pixel { width: 12px; height: 12px; cursor: crosshair; }

        .online-user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
            background: #252525;
            margin-bottom: 4px;
            border: 1px solid #333;
        }
        .dot { width: 8px; height: 8px; background: #2ecc71; border-radius: 50%; /* shadow kaldÄ±rÄ±ldÄ± */ }

        #vCanvas {
            background: #2a2a2a; /* Gradyan kaldÄ±rÄ±ldÄ± */
            border-bottom: 5px solid #2ecc71;
        }

        #toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #444;
            color: white;
            padding: 10px 20px;
            border: 1px solid #777;
            z-index: 999999;
            display: none;
            font-weight: bold;
        }

        .popup {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50000;
        }
    </style>
</head>
<body>

<div id="toast">Bildirim MesajÄ±</div>

<div class="center" id="authDiv">
    <div class="card">
        <h1 style="color: #d559ff; margin-bottom: 10px;">ğŸ‘‘ OynaKral</h1>
        <p style="font-size: 12px; color: #aaa; margin-bottom: 10px;">Remobaba Lite SÃ¼rÃ¼m</p>
        <input id="username" placeholder="KullanÄ±cÄ± AdÄ±">
        <input id="password" type="password" placeholder="Åifre">
        <button id="loginBtn">GiriÅŸ Yap</button>
        <button id="registerBtn" style="background:#333">Yeni Hesap OluÅŸtur</button>
    </div>
</div>

<div class="center hidden" id="gameSelect">
    <div class="card">
        <h2 style="margin-bottom: 15px;">ğŸ® HoÅŸ Geldin!</h2>
        <button id="btnC" style="background: #2980b9;">ğŸ–±ï¸ TÄ±klamaca</button>
        <button id="btnR" style="background: #27ae60;">ğŸ¨ Rplace</button>
        <button id="btnV" style="background: #f39c12;">ğŸ Voleybol</button>
        <button id="logoutBtn" style="background:#c0392b; margin-top:30px;">GÃ¼venli Ã‡Ä±kÄ±ÅŸ</button>
    </div>
</div>

<div id="gameRoot" class="hidden">
    <div class="sidebar">
        <button onclick="document.getElementById('marketPop').style.display='flex'">ğŸ›’ Market</button>
        <button onclick="document.getElementById('casinoPop').style.display='flex'">ğŸ° Casino (YazÄ±-Tura)</button>
        <button class="backMenu" style="background: #444;">â¬… Ana MenÃ¼</button>
    </div>
    <div class="center">
        <div class="card" style="width: 500px;">
            <h1 id="scoreDisp" style="font-size: 40px; color: #f1c40f;">AltÄ±n: 0</h1>
            <h3 id="powerDisp" style="color: #3498db; margin-bottom: 20px;">TÄ±klama GÃ¼cÃ¼: 1</h3>
            <button id="clickBtn" style="height:200px; width:200px; font-size:80px; border-radius: 50%; border: 5px solid #4a2b96; background: #222;">ğŸ–±ï¸</button>
        </div>
    </div>
    <div class="chat-sidebar">
        <h3 style="text-align: center; color: #f1c40f;">ğŸ† Zenginler Listesi</h3>
        <ul id="board" style="padding:15px 0; list-style:none;"></ul>
        <div class="chat-msgs" id="cMsgs"></div>
        <div style="display:flex; gap:5px;">
            <input id="cIn" placeholder="Mesaj yaz..." style="margin:0;">
            <button id="cSend" style="width:70px; margin:0;">ğŸš€</button>
        </div>
    </div>
</div>

<div id="rplaceRoot" class="hidden">
    <div class="sidebar">
        <button class="backMenu" style="background: #444;">â¬… MenÃ¼</button>
        <div style="color:#9e6eff; font-weight:bold; font-size: 20px; margin-top: 10px;">ğŸŸ¢ Aktif: <span id="rCount">0</span></div>
        <div id="onlineList" style="margin-top: 20px;"></div>
    </div>
    <div id="rCenter"><div id="canvasWrap"><div id="canvas"></div></div></div>
    <div class="chat-sidebar">
        <h3 style="text-align: center; color: #27ae60;">ğŸ’¬ KÃ¼resel Sohbet</h3>
        <div class="chat-msgs" id="rMsgs"></div>
        <div style="display:flex; gap:5px;">
            <input id="rIn" placeholder="Buraya yaz..." style="margin:0;">
            <button id="rSend" style="width:70px; margin:0;">ğŸš€</button>
        </div>
    </div>
    <div id="rBottom" style="grid-column: 1/4; display: flex; align-items: center; justify-content: center; background: #1a1a1a; border-top: 2px solid #555; gap: 30px; height: 80px;">
        <input type="color" id="color" value="#ff0000" style="width:50px; height:50px; border:none; background:none;">
        <div style="font-size:20px; font-weight: bold;">ğŸ¨ Kalan Boya: <span id="paintText" style="color:#9e6eff;">30</span> / 30</div>
    </div>
</div>

<div id="voleybolRoot" class="hidden">
    <div class="sidebar">
        <button class="backMenu" style="background: #444;">â¬… MenÃ¼</button>
        <div id="vLobby">
            <button id="vCreate" style="background: #27ae60;">Oda OluÅŸtur</button>
            <input id="vJoinCode" placeholder="Oda Kodu Gir">
            <button id="vJoin" style="background: #2980b9;">Odaya KatÄ±l</button>
        </div>
        <div id="vInfo" class="hidden">
            <h3 id="vDispCode" style="color:#f39c12;">ODA: -</h3>
            <div id="vPlayerList" style="padding:15px; background:#222; margin: 10px 0;"></div>
            <button id="vStart" class="hidden" style="background:#2ecc71">OYUNU BAÅLAT</button>
            <h2 id="vScore" style="margin-top:30px; color:#f1c40f; font-size:50px; text-align: center;">0 - 0</h2>
        </div>
    </div>
    <div class="center"><canvas id="vCanvas" width="800" height="400" class="hidden"></canvas></div>
    <div class="chat-sidebar hidden" id="vChatSide">
        <h3 style="text-align: center;">ğŸ’¬ Oda Sohbeti</h3>
        <div class="chat-msgs" id="vMsgs"></div>
        <div style="display:flex; gap:5px;">
            <input id="vIn" placeholder="Mesaj..." style="margin:0;">
            <button id="vSend" style="width:70px; margin:0;">ğŸš€</button>
        </div>
    </div>
</div>

<div id="marketPop" class="popup">
    <div class="card">
        <h2 style="color: #2ecc71;">ğŸ›’ Market</h2>
        <p id="marketInfo" style="margin: 20px 0; font-size: 16px;"></p>
        <button id="buyPowerBtn" style="background: #27ae60;">GELÄ°ÅTÄ°R (+1 GÃœÃ‡)</button>
        <button onclick="document.getElementById('marketPop').style.display='none'" style="background:#444">Kapat</button>
    </div>
</div>

<div id="casinoPop" class="popup">
    <div class="card">
        <h2 style="color: #f1c40f;">ğŸ° YazÄ±-Tura Casino</h2>
        <input id="betAmount" type="number" placeholder="Bahis miktarÄ±nÄ± girin">
        <div style="display:flex; gap:15px; margin-top: 10px;">
            <button id="betYazi" style="background: #2ecc71; height: 60px;">YAZI</button>
            <button id="betTura" style="background: #e67e22; height: 60px;">TURA</button>
        </div>
        <p id="casinoResult" style="margin-top:20px; font-weight:bold; font-size: 18px; min-height: 25px;"></p>
        <button onclick="document.getElementById('casinoPop').style.display='none'" style="background:#444">Masadan Kalk</button>
    </div>
</div>

<div id="resultPop" class="popup">
    <div class="card">
        <h1 id="resultTitle">OYUN BÄ°TTÄ°</h1>
        <p id="resultDesc" style="margin: 20px 0; font-size: 20px;"></p>
        <button onclick="location.reload()" style="background: #4a2b96;">TAMAM</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, set, push, onValue, runTransaction, get, remove, update, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCGUe_LPKRAVz1IoqMDn-8ie9RWCrVRQLs",
        authDomain: "click-game-2de2f.firebaseapp.com",
        databaseURL: "https://click-game-2de2f-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let user = null;
    let userData = null;
    let curRoom = null;
    let isHost = false;
    let roomData = null;
    let gameEnded = false;

    function showNotify(msg) {
        const t = document.getElementById("toast");
        t.innerText = msg;
        t.style.display = "block";
        setTimeout(() => { t.style.display = "none"; }, 3000);
    }

    onAuthStateChanged(auth, u => {
        if (!u) {
            document.getElementById("authDiv").classList.remove("hidden");
            document.getElementById("gameSelect").classList.add("hidden");
            return;
        }
        user = u;
        document.getElementById("authDiv").classList.add("hidden");
        document.getElementById("gameSelect").classList.remove("hidden");

        onValue(ref(db, "users/" + u.uid), s => {
            userData = s.val();
            if (!userData) return;
            if (userData.kicked) {
                update(ref(db, "users/" + user.uid), { kicked: false });
                signOut(auth);
                location.reload();
            }
            document.getElementById("scoreDisp").innerText = "AltÄ±n: " + (userData.score || 0);
            document.getElementById("powerDisp").innerText = "TÄ±klama GÃ¼cÃ¼: " + (userData.power || 1);
            document.getElementById("paintText").innerText = userData.paint || 0;
            document.getElementById("marketInfo").innerText = `Mevcut GÃ¼Ã§: ${userData.power} | GeliÅŸtirme Bedeli: ${userData.price || 100} AltÄ±n`;
        });
    });

    // CASINO
    function handleCasino(choice) {
        const bet = parseInt(document.getElementById("betAmount").value);
        if (!bet || bet <= 0) { showNotify("LÃ¼tfen geÃ§erli bir bahis gir!"); return; }
        runTransaction(ref(db, "users/" + user.uid), d => {
            if (!d) return d;
            if (d.score < bet) return undefined;
            d.score -= bet;
            return d;
        }).then(result => {
            if (!result.committed) { showNotify("Yetersiz AltÄ±n!"); return; }
            const winResult = Math.random() < 0.5 ? "yazi" : "tura";
            const isWin = winResult === choice;
            const resEl = document.getElementById("casinoResult");
            if (isWin) {
                runTransaction(ref(db, "users/" + user.uid), d => { if (d) d.score += (bet * 2); return d; });
                resEl.style.color = "#2ecc71";
                resEl.innerText = "KAZANDIN! SonuÃ§: " + winResult.toUpperCase();
            } else {
                resEl.style.color = "#e74c3c";
                resEl.innerText = "KAYBETTÄ°N! SonuÃ§: " + winResult.toUpperCase();
            }
        });
    }
    document.getElementById("betYazi").onclick = () => handleCasino("yazi");
    document.getElementById("betTura").onclick = () => handleCasino("tura");

    // ADMIN KOMUTLARI
    async function checkAdminCommands(val) {
        if (userData.username !== "remobaba") return false;
        const p = val.split(" ");
        const cmd = p[0].toLowerCase();
        const target = p[1];
        if (cmd === "/temizle") {
            await set(ref(db, "chat"), null);
            await set(ref(db, "global_notif"), "Chat temizlendi (remobaba)");
            return true;
        }
        const usersSnap = await get(ref(db, "users"));
        const allUsers = usersSnap.val();
        let targetId = null;
        for (let id in allUsers) { if (allUsers[id].username === target) targetId = id; }
        if (!targetId) return false;
        if (cmd === "/yasakla") {
            await update(ref(db, `users/${targetId}`), { kicked: true });
            await set(ref(db, "global_notif"), `${target} yasaklandÄ± (remobaba)`);
        } else if (cmd === "/sustur") {
            await update(ref(db, `users/${targetId}`), { muted: true });
            await set(ref(db, "global_notif"), `${target} susturuldu (remobaba)`);
        }
        return true;
    }

    onValue(ref(db, "global_notif"), s => {
        if (s.val()) { showNotify(s.val()); set(ref(db, "global_notif"), null); }
    });

    // CHAT
    function setupChat(elId, path) {
        onValue(ref(db, path), s => {
            const el = document.getElementById(elId);
            el.innerHTML = "";
            const data = s.val();
            if (!data) return;
            Object.values(data).forEach(m => {
                const nameClass = m.u === "remobaba" ? "admin-name" : "user-name";
                el.innerHTML += `<div><b class="${nameClass}">${m.u}:</b> ${m.t}</div>`;
            });
            el.scrollTop = el.scrollHeight;
        });
    }

    async function sendChatMessage(inpId, path) {
        const inp = document.getElementById(inpId);
        if (!inp.value) return;
        if (userData.muted) { showNotify("Susturuldun!"); return; }
        if (inp.value.startsWith("/")) { if (await checkAdminCommands(inp.value)) { inp.value = ""; return; } }
        push(ref(db, path), { u: userData.username, t: inp.value });
        inp.value = "";
    }

    document.getElementById("cSend").onclick = () => sendChatMessage("cIn", "chat/tik");
    document.getElementById("rSend").onclick = () => sendChatMessage("rIn", "chat/rpl");
    setupChat("cMsgs", "chat/tik");
    setupChat("rMsgs", "chat/rpl");

    // TIKLAMACA
    document.getElementById("clickBtn").onclick = () => {
        runTransaction(ref(db, "users/" + user.uid), d => {
            if (d) d.score = (d.score || 0) + (d.power || 1);
            return d;
        });
    };

    onValue(ref(db, "users"), s => {
        const d = s.val(); if (!d) return;
        const sorted = Object.values(d).sort((a, b) => b.score - a.score).slice(0, 5);
        document.getElementById("board").innerHTML = sorted.map(u => {
            const nCls = u.username === "remobaba" ? "admin-name" : "user-name";
            return `<li style="margin-bottom:8px; background:#222; padding:8px; border-left: 3px solid #7a3cff;">
                <b class="${nCls}">${u.username}</b>: ${u.score}
            </li>`;
        }).join("");
    });

    document.getElementById("buyPowerBtn").onclick = () => {
        runTransaction(ref(db, "users/" + user.uid), d => {
            if (!d) return d;
            let p = d.price || 100;
            if (d.score >= p) { d.score -= p; d.power++; d.price = Math.floor(p * 1.5); }
            return d;
        });
    };

    // RPLACE MANTIÄI
    const cvs = document.getElementById("canvas");
    for (let i = 0; i < 40000; i++) {
        const p = document.createElement("div");
        p.className = "pixel";
        p.onclick = () => {
            if (userData.paint > 0) {
                runTransaction(ref(db, `users/${user.uid}/paint`), c => (c || 0) - 1);
                set(ref(db, `rplace/pixels/${i}`), document.getElementById("color").value);
            } else { showNotify("Boya bekleyin..."); }
        };
        cvs.appendChild(p);
    }
    onValue(ref(db, "rplace/pixels"), s => {
        const data = s.val(); if (!data) return;
        Object.keys(data).forEach(k => { if (cvs.children[k]) cvs.children[k].style.background = data[k]; });
    });

    function startPresenceTracking() {
        const myPresenceRef = ref(db, `rplace/online/${user.uid}`);
        onDisconnect(myPresenceRef).remove();
        set(myPresenceRef, { username: userData.username });
        onValue(ref(db, "rplace/online"), s => {
            const listEl = document.getElementById("onlineList");
            const countEl = document.getElementById("rCount");
            const allPlayers = s.val();
            listEl.innerHTML = "";
            if (!allPlayers) { countEl.innerText = "0"; return; }
            const validPlayers = Object.values(allPlayers).filter(p => p.username && p.username !== "undefined");
            countEl.innerText = validPlayers.length;
            validPlayers.forEach(p => {
                const nCls = p.username === "remobaba" ? "admin-name" : "user-name";
                listEl.innerHTML += `<div class="online-user"><div class="dot"></div><span class="${nCls}">${p.username}</span></div>`;
            });
        });
    }

    // VOLEYBOL MANTIÄI
    const vC = document.getElementById("vCanvas");
    const ctx = vC.getContext("2d");
    let keys = {};
    window.onkeydown = e => keys[e.code] = true;
    window.onkeyup = e => keys[e.code] = false;
    let v_vy = 0, v_onG = true;

    function vEnd(t, d) {
        if (gameEnded) return;
        gameEnded = true;
        document.getElementById("resultTitle").innerText = t;
        document.getElementById("resultDesc").innerText = d;
        document.getElementById("resultPop").style.display = "flex";
        if (curRoom) remove(ref(db, `rooms/${curRoom}`));
    }

    document.getElementById("vCreate").onclick = () => {
        const id = Math.floor(1000 + Math.random() * 9000);
        curRoom = id; isHost = true;
        const rRef = ref(db, `rooms/${id}`);
        set(rRef, { host: userData.username, hostId: user.uid, status: "waiting", p1x: 150, p1y: 380, p2x: 650, p2y: 380, bx: 400, by: 180, bvx: 0, bvy: 0, s1: 0, s2: 0 });
        onDisconnect(rRef).remove();
        initVolleyballRoom(id);
    };

    document.getElementById("vJoin").onclick = () => {
        const id = document.getElementById("vJoinCode").value;
        get(ref(db, `rooms/${id}`)).then(s => {
            if (s.exists() && !s.val().guest) {
                curRoom = id; isHost = false;
                update(ref(db, `rooms/${id}`), { guest: userData.username, guestId: user.uid });
                initVolleyballRoom(id);
            }
        });
    };

    function initVolleyballRoom(id) {
        document.getElementById("vLobby").classList.add("hidden");
        document.getElementById("vInfo").classList.remove("hidden");
        vC.classList.remove("hidden");
        document.getElementById("vChatSide").classList.remove("hidden");
        document.getElementById("vDispCode").innerText = "ODA: " + id;
        setupChat("vMsgs", `vchat/${id}`);
        onValue(ref(db, `rooms/${id}`), s => {
            roomData = s.val();
            if (!roomData) return;
            if (roomData.status === "playing") {
                document.getElementById("vStart").classList.add("hidden");
                drawVolleyball(roomData);
            } else {
                document.getElementById("vPlayerList").innerHTML = `<b>P1:</b> ${roomData.host} <br> <b>P2:</b> ${roomData.guest || 'Bekleniyor...'}`;
                if (isHost && roomData.guest) document.getElementById("vStart").classList.remove("hidden");
            }
            document.getElementById("vScore").innerText = `${roomData.s1} - ${roomData.s2}`;
        });
    }

    document.getElementById("vStart").onclick = () => update(ref(db, `rooms/${curRoom}`), { status: "playing" });

    setInterval(() => {
        if (!curRoom || !roomData || roomData.status !== "playing" || gameEnded) return;
        let mx = isHost ? roomData.p1x : roomData.p2x;
        let my = isHost ? roomData.p1y : roomData.p2y;
        if (keys['KeyA'] || keys['ArrowLeft']) mx -= 12;
        if (keys['KeyD'] || keys['ArrowRight']) mx += 12;
        if ((keys['KeyW'] || keys['ArrowUp']) && v_onG) { v_vy = -18; v_onG = false; }
        if (!v_onG) { v_vy += 0.9; my += v_vy; if (my >= 380) { my = 380; v_vy = 0; v_onG = true; } }
        if (isHost) { if (mx < 40) mx = 40; if (mx > 365) mx = 365; }
        else { if (mx < 435) mx = 435; if (mx > 760) mx = 760; }
        if (isHost) {
            let nx = roomData.bx + roomData.bvx, ny = roomData.by + roomData.bvy, nvx = roomData.bvx, nvy = roomData.bvy;
            if (nvx !== 0 || nvy !== 0) nvy += 0.4;
            if (Math.hypot(nx - roomData.p1x, ny - (roomData.p1y - 20)) < 45) { nvy = -12; nvx = (nx - roomData.p1x) * 0.5; }
            if (Math.hypot(nx - roomData.p2x, ny - (roomData.p2y - 20)) < 45) { nvy = -12; nvx = (nx - roomData.p2x) * 0.4; }
            if (nx > 385 && nx < 415 && ny > 250) { nvx *= -1.2; nx = (nx < 400) ? 384 : 416; }
            if (nx < 15 || nx > 785) nvx *= -1;
            if (ny < 15) nvy *= -1;
            if (ny > 395) {
                const w = nx > 400;
                update(ref(db, `rooms/${curRoom}`), { s1: roomData.s1 + (w ? 1 : 0), s2: roomData.s2 + (w ? 0 : 1), bx: w ? 600 : 200, by: 180, bvx: 0, bvy: 0 });
            } else update(ref(db, `rooms/${curRoom}`), { bx: nx, by: ny, bvx: nvx, bvy: nvy, p1x: mx, p1y: my });
        } else {
            update(ref(db, `rooms/${curRoom}/p2x`), mx);
            update(ref(db, `rooms/${curRoom}/p2y`), my);
        }
    }, 35);

    function drawVolleyball(d) {
        ctx.clearRect(0,0,800,400);
        ctx.fillStyle="#fff"; ctx.fillRect(397, 250, 6, 150);
        ctx.fillStyle="#ff3c7a"; ctx.beginPath(); ctx.arc(d.p1x, d.p1y, 35, Math.PI, 0); ctx.fill();
        ctx.fillStyle="#3cff7a"; ctx.beginPath(); ctx.arc(d.p2x, d.p2y, 35, Math.PI, 0); ctx.fill();
        ctx.fillStyle="#f1c40f"; ctx.beginPath(); ctx.arc(d.bx, d.by, 15, 0, Math.PI * 2); ctx.fill();
    }

    document.getElementById("btnC").onclick = () => { document.getElementById("gameSelect").classList.add("hidden"); document.getElementById("gameRoot").classList.remove("hidden"); };
    document.getElementById("btnR").onclick = () => { document.getElementById("gameSelect").classList.add("hidden"); document.getElementById("rplaceRoot").classList.remove("hidden"); startPresenceTracking(); };
    document.getElementById("btnV").onclick = () => { document.getElementById("gameSelect").classList.add("hidden"); document.getElementById("voleybolRoot").classList.remove("hidden"); };
    document.querySelectorAll(".backMenu").forEach(b => b.onclick = () => location.reload());
    document.getElementById("vSend").onclick = () => sendChatMessage("vIn", `vchat/${curRoom}`);
    document.getElementById("logoutBtn").onclick = () => signOut(auth);

    document.getElementById("loginBtn").onclick = () => {
        const email = document.getElementById("username").value + "@oynakral.com";
        signInWithEmailAndPassword(auth, email, document.getElementById("password").value);
    };

    document.getElementById("registerBtn").onclick = async () => {
        const name = document.getElementById("username").value;
        const pass = document.getElementById("password").value;
        const res = await createUserWithEmailAndPassword(auth, name + "@oynakral.com", pass);
        await set(ref(db, "users/" + res.user.uid), { username: name, score: 0, power: 1, price: 100, paint: 30 });
    };

    setInterval(() => { if (user && userData) runTransaction(ref(db, `users/${user.uid}/paint`), p => ((p || 0) < 30) ? (p || 0) + 1 : 30); }, 5000);
</script>
</body>
</html>

